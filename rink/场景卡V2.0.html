<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ•é¦–ä¹‹å¿ƒåœºæ™¯å¡ç‰‡ç”Ÿæˆå™¨ (V2.3)</title>
    <!-- å¼•å…¥ html2canvas -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <!-- å¼•å…¥ Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&family=Oswald:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* UI é¢œè‰²å˜é‡ */
            --bg-body: #f4f6f8;
            --bg-panel: #ffffff;
            --primary-ui: #2c3e50;
            --accent-ui: #1c538a; /* åœºæ™¯å¡é»˜è®¤è“è‰²ç³» */
            --accent-hover: #266cb3;
            --border-ui: #e1e4e8;
            --text-main: #333;
            --text-muted: #666;
            
            /* å¡ç‰‡é»˜è®¤å˜é‡ */
            --card-border-radius: 16px;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        h1, h2, h3, h4 { margin: 0; font-family: 'Oswald', sans-serif; }

        /* --- å¸ƒå±€ç»“æ„ --- */
        .app-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-ui);
        }
        .app-header h1 { color: var(--accent-ui); font-size: 2.2rem; }
        .app-header p { color: var(--text-muted); font-size: 0.9rem; margin-top: 5px; font-weight: 500; }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr; /* å·¦å³ä¸¤æ  */
            gap: 30px;
            align-items: start;
        }

        /* --- å·¦ä¾§ï¼šé…ç½®è¡¨å•åŒº --- */
        .config-panel {
            background: var(--bg-panel);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            padding: 0;
            overflow: hidden;
        }

        /* æŠ˜å é¢æ¿æ ·å¼ */
        .accordion-item { border-bottom: 1px solid var(--border-ui); }
        .accordion-header {
            padding: 15px 20px;
            background: #f9fafb;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: var(--primary-ui);
            transition: background 0.2s;
            user-select: none;
        }
        .accordion-header:hover { background: #f0f2f5; }
        .accordion-header::after { content: '+'; font-size: 1.2rem; color: var(--text-muted); }
        .accordion-item.active .accordion-header::after { content: '-'; }
        
        .accordion-content {
            display: none;
            padding: 20px;
            animation: slideDown 0.3s ease-out;
        }
        .accordion-item.active .accordion-content { display: block; }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* è¡¨å•æ§ä»¶ç¾åŒ– */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-group { margin-bottom: 15px; }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input[type="text"], input[type="number"], select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-ui);
            border-radius: 6px;
            font-size: 0.95rem;
            transition: border-color 0.2s, box-shadow 0.2s;
            font-family: inherit;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-ui);
            box-shadow: 0 0 0 3px rgba(28, 83, 138, 0.1);
        }
        textarea { min-height: 80px; resize: vertical; }

        /* é¢œè‰²é€‰æ‹©å™¨ç»„ */
        .color-group { display: flex; align-items: center; gap: 8px; }
        .color-group input[type="color"] {
            width: 40px; height: 40px; border: none; background: none; padding: 0; cursor: pointer;
        }

        /* Markdown æç¤º */
        .markdown-hint {
            background: #f0f4f8;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            color: #555;
            margin-bottom: 15px;
            border-left: 3px solid var(--accent-ui);
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn-group {
            display: flex; flex-wrap: wrap; gap: 10px; padding: 20px; background: #fafbfc; border-top: 1px solid var(--border-ui); position: sticky; bottom: 0; z-index: 10;
        }
        
        button {
            background-color: var(--primary-ui);
            color: white; border: none; padding: 10px 18px; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s; font-size: 0.9rem; display: inline-flex; align-items: center; justify-content: center;
        }
        button:hover { transform: translateY(-1px); box-shadow: 0 2px 5px rgba(0,0,0,0.15); opacity: 0.9; }
        button:active { transform: translateY(0); }

        button.btn-accent { background-color: var(--accent-ui); }
        button.btn-accent:hover { background-color: var(--accent-hover); }
        
        button.btn-outline { background-color: transparent; border: 1px solid var(--border-ui); color: var(--text-main); }
        button.btn-outline:hover { background-color: #f0f0f0; }

        .add-btn { width: 100%; margin-top: 10px; background-color: #edf2f7; color: var(--primary-ui); }
        .add-btn:hover { background-color: #e2e8f0; }
        
        .remove-btn { background-color: #e53e3e; padding: 5px 10px; font-size: 0.8rem; margin-left: 5px; width: auto;}

        /* --- å³ä¾§ï¼šé¢„è§ˆåŒº --- */
        .preview-panel { position: sticky; top: 20px; }
        .preview-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        /* é¢„è§ˆå¡ç‰‡å®¹å™¨èƒŒæ™¯ */
        .card-wrapper {
            background: #e8eaed;
            padding: 40px;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
            min-height: 600px;
        }

        /* =========================================
           æ ¸å¿ƒå¡ç‰‡æ ·å¼ (åœºæ™¯å¡ä¸“ç”¨)
           ========================================= */
        .environment-card {
            font-family: 'Crimson Text', serif;
            width: 500px;
            background: #fff;
            border: 2px solid var(--text-main);
            border-radius: var(--card-border-radius);
            padding: 20px;
            position: relative;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.15);
            color: #222;
            display: flex;
            flex-direction: column;
        }

        /* å¤´éƒ¨ */
        .environment-header {
            border-bottom: 2px solid var(--accent-ui);
            padding-bottom: 10px;
            margin-bottom: 15px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        .environment-header.has-image { grid-template-columns: 1fr auto; }

        .environment-name {
            font-family: 'Oswald', sans-serif;
            font-size: 28px;
            font-weight: 700;
            text-transform: uppercase;
            line-height: 1.1;
            margin-bottom: 2px;
        }
        .environment-name-en {
            font-family: 'Oswald', sans-serif;
            font-size: 16px;
            font-weight: 700;
            color: var(--accent-ui);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .environment-rank-line {
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 700;
            font-size: 18px;
            color: #444;
            margin-bottom: 8px;
        }

        .environment-description {
            font-style: italic;
            font-size: 15px;
            line-height: 1.4;
            color: #555;
            white-space: pre-wrap; /* å…³é”®ï¼šä¿ç•™æ¢è¡Œå’Œç©ºæ ¼ */
        }

        /* åœºæ™¯ç«‹ç»˜åŒºåŸŸ */
        .environment-image-container {
            display: none;
            width: 350px; /* é»˜è®¤å®½åº¦ï¼ŒJSå¯æ§ */
            height: 200px; /* é»˜è®¤é«˜åº¦ï¼ŒJSå¯æ§ */
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .environment-header.has-image .environment-image-container { display: flex; }

        .environment-image {
            width: 100%; height: 100%;
            border-radius: 8px;
            border: 3px solid var(--accent-ui);
            background-color: white;
            overflow: hidden;
            position: relative;
        }
        .environment-image.no-border {
            border: none;
            background: transparent;
        }
        .environment-image-inner {
            display: block; width: auto; height: auto;
            transform-origin: center center;
        }

        /* è¶‹å‘ä¸æ•Œäºº */
        .tendencies-section, .enemies-section {
            margin: 10px 0;
            font-size: 15px;
            line-height: 1.5;
        }
        .label-block {
            display: block; /* å¼ºåˆ¶æ¢è¡Œæˆ–è€…ä½œä¸ºå—çº§æ ‡é¢˜ */
            font-weight: 700; 
            color: #222;
            margin-bottom: 4px;
        }
        /* ä¼˜åŒ–é•¿æ–‡æœ¬æ˜¾ç¤º */
        .text-content-block {
            display: block;
            white-space: pre-wrap; /* å…è®¸æ¢è¡Œ */
            color: #444;
        }

        /* ç‰¹æ€§åˆ—è¡¨ */
        .environment-traits { margin-top: 15px; }
        .trait-header {
            font-family: 'Oswald', sans-serif;
            font-size: 18px;
            font-weight: bold;
            border-bottom: 1px solid #ccc;
            padding-bottom: 4px;
            margin-bottom: 10px;
            color: var(--text-muted);
        }

        .trait { margin-bottom: 12px; padding-left: 10px; }
        .trait-name { font-weight: 700; font-size: 16px; display: block; margin-bottom: 2px; }
        .trait-desc { font-size: 15px; line-height: 1.4; display: block; white-space: pre-wrap; }
        .trait-desc::before { content: "â€¢ "; font-weight: bold; }
        .trait-questions { font-style: italic; color: #666; font-size: 14px; margin-top: 4px; display: block; white-space: pre-wrap; }

        /* Markdown Highlight */
        .markdown-content mark { background: rgba(28, 83, 138, 0.2); color: inherit; padding: 0 2px; border-radius: 2px; }
        .markdown-content { white-space: pre-wrap; } /* ç¡®ä¿æ‰€æœ‰ markdown åŒºåŸŸæ”¯æŒæ¢è¡Œ */

        /* Hidden */
        .hidden { display: none !important; }

        /* Modal: ç¼–è¾‘å™¨å®Œå…¨å¤åˆ»æ•Œäººè½¦å¡å™¨çš„æ·±è‰²é£æ ¼ */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); backdrop-filter: blur(5px); justify-content: center; align-items: center; }
        .modal-content { 
            background-color: #222; /* æ·±è‰²èƒŒæ™¯ */
            color: #eee;
            padding: 25px; 
            border-radius: 12px; 
            width: 95%; max-width: 900px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); 
            position: relative; 
            display: flex; gap: 20px;
            border: 1px solid #444;
        }
        .close-modal { position: absolute; right: 15px; top: 10px; font-size: 24px; cursor: pointer; color: #999; }
        .close-modal:hover { color: #fff; }

        /* ç¼–è¾‘é¢„è§ˆåŒºçš„æ£‹ç›˜æ ¼èƒŒæ™¯ */
        .modal-preview-area {
            flex: 2;
            background-color: #333;
            background-image: linear-gradient(45deg, #444 25%, transparent 25%), linear-gradient(-45deg, #444 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #444 75%), linear-gradient(-45deg, transparent 75%, #444 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            border-radius: 8px;
            display: flex; 
            justify-content: center; 
            align-items: center;
            min-height: 400px;
            overflow: auto; /* é˜²æ­¢è¶…å¤§å›¾æº¢å‡º */
            position: relative;
            border: 2px solid #555;
        }

        /* æ¨¡æ€æ¡†å†…çš„å›¾ç‰‡æ¡† - å¿…é¡»ä¸¥æ ¼ç­‰äºå¡ç‰‡å°ºå¯¸ */
        #previewSceneFrame {
            overflow: hidden; 
            position: relative; 
            /* è¾¹æ¡†é¢œè‰²çªå‡ºæ˜¾ç¤º */
            border: 2px dashed var(--accent-ui); 
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            background: rgba(255,255,255,0.1); /* å¾®å¾®å‘äº®è¡¨ç¤ºåŒºåŸŸ */
            flex-shrink: 0; /* é˜²æ­¢è¢« flex å‹ç¼© */
        }

        /* æ¨¡æ€æ¡†æ§ä»¶ */
        .modal-controls { flex: 1; min-width: 250px; display: flex; flex-direction: column; justify-content: center; }
        .modal-controls label { color: #ccc; }
        
        /* ç‰¹æ€§è¾“å…¥ç»„æ ·å¼ */
        .trait-input-box {
            border: 1px solid #eee; padding: 15px; border-radius: 8px; margin-bottom: 15px; background: #fafafa;
        }
        
        /* å“åº”å¼ */
        @media (max-width: 1024px) {
            .main-container { grid-template-columns: 1fr; }
            .preview-panel { position: static; margin-top: 20px; }
            .card-wrapper { padding: 20px; }
        }
        @media (max-width: 800px) {
            .modal-content { flex-direction: column; overflow-y: auto; max-height: 90vh; }
            .modal-preview-area { min-height: 250px; }
        }

        /* æ»‘å—ç¾åŒ– */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: var(--accent-ui); cursor: pointer; margin-top: -6px; box-shadow: 0 1px 3px rgba(0,0,0,0.3); border: 2px solid white; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #555; border-radius: 2px; }
    </style>
</head>
<body>

    <div class="app-header">
        <h1>â›°ï¸ åŒ•é¦–ä¹‹å¿ƒ Â· åœºæ™¯å¡ç‰‡ç”Ÿæˆå™¨</h1>
        <p>V2.3 | 20251216å¼€æºç½‘é¡µ | Rink_CXåˆ¶ä½œ</p>
    </div>

    <div class="main-container">
        
        <!-- å·¦ä¾§ï¼šé…ç½®é¢æ¿ -->
        <div class="config-panel">
            
            <!-- æŠ˜å é¡¹ 1: å…¨å±€è®¾ç½® -->
            <div class="accordion-item active">
                <div class="accordion-header" onclick="toggleAccordion(this)">âš™ï¸ å…¨å±€è®¾ç½®ä¸é¢œè‰²</div>
                <div class="accordion-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label>ä¸»é¢˜è‰² (è£…é¥°æ¡)</label>
                            <div class="color-group">
                                <input type="color" id="decoratorColorPicker" value="#1c538a" oninput="syncColorInput('decoratorColorPicker', 'decoratorColor'); updateCard()">
                                <input type="text" id="decoratorColor" value="#1c538a" oninput="syncColorInput('decoratorColor', 'decoratorColorPicker'); updateCard()">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Markdown é«˜äº®æ ·å¼ (==æ–‡å­—==)</label>
                        <div class="form-row">
                            <div class="color-group">
                                <span>èƒŒæ™¯:</span>
                                <input type="color" id="highlightBgColorPicker" value="#852020" oninput="syncColorInput('highlightBgColorPicker', 'highlightBgColor'); updateCard()">
                                <input type="hidden" id="highlightBgColor" value="#852020">
                            </div>
                            <div class="color-group">
                                <span>æ–‡å­—:</span>
                                <input type="color" id="highlightTextColorPicker" value="#FFFFFF" oninput="syncColorInput('highlightTextColorPicker', 'highlightTextColor'); updateCard()">
                                <input type="hidden" id="highlightTextColor" value="#FFFFFF">
                            </div>
                        </div>
                    </div>
                    
                    <div class="markdown-hint">
                        æ”¯æŒ Markdown: *æ–œä½“*, **åŠ ç²—**, ==é«˜äº®==
                    </div>
                </div>
            </div>

            <!-- æŠ˜å é¡¹ 2: åŸºæœ¬ä¿¡æ¯ -->
            <div class="accordion-item active">
                <div class="accordion-header" onclick="toggleAccordion(this)">ğŸ“ åŸºæœ¬ä¿¡æ¯</div>
                <div class="accordion-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="name">åç§°</label>
                            <input type="text" id="name" placeholder="ä¾‹å¦‚ï¼šæ±¹æ¶Œæ²³æµ" oninput="updateCard()">
                        </div>
                        <div class="form-group">
                            <label for="nameEn">è‹±æ–‡åç§°</label>
                            <input type="text" id="nameEn" placeholder="RAGING RIVER" oninput="updateCard()">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="rank">ä½é˜¶</label>
                            <select id="rank" onchange="updateCard()">
                                <option value="1">ä½é˜¶ 1</option>
                                <option value="2">ä½é˜¶ 2</option>
                                <option value="3">ä½é˜¶ 3</option>
                                <option value="4">ä½é˜¶ 4</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="type">ç±»å‹</label>
                            <select id="type" onchange="updateCard()">
                                <option value="é™©å¢ƒ">é™©å¢ƒ</option>
                                <option value="æ¢ç´¢">æ¢ç´¢</option>
                                <option value="ç¤¾äº¤">ç¤¾äº¤</option>
                                <option value="äº‹ä»¶">äº‹ä»¶</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="difficulty">éš¾åº¦</label>
                        <input type="number" id="difficulty" value="10" min="1" max="30" oninput="updateCard()">
                    </div>
                </div>
            </div>

            <!-- æŠ˜å é¡¹ 3: è¯¦ç»†æè¿° -->
            <div class="accordion-item active">
                <div class="accordion-header" onclick="toggleAccordion(this)">ğŸ“œ è¯¦ç»†æè¿°</div>
                <div class="accordion-content">
                    <div class="form-group">
                        <label for="description">åœºæ™¯æè¿° (æ”¯æŒå›è½¦æ¢è¡Œ)</label>
                        <textarea id="description" placeholder="æ”¯æŒ Markdown" oninput="updateCard()"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="tendencies">è¶‹å‘ (Tendencies)</label>
                        <textarea id="tendencies" style="min-height: 60px;" placeholder="ä¾‹å¦‚ï¼šé˜»éš”é€šè¡Œ..." oninput="updateCard()"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="enemies">æ½œåœ¨æ•Œäºº</label>
                        <textarea id="enemies" style="min-height: 60px;" placeholder="ä¾‹å¦‚ï¼šé‡å…½, å¼ºç›—..." oninput="updateCard()"></textarea>
                    </div>
                </div>
            </div>

            <!-- æŠ˜å é¡¹ 4: åœºæ™¯ç«‹ç»˜ (V2.3: å®Œå…¨å¤åˆ») -->
            <div class="accordion-item active">
                <div class="accordion-header" onclick="toggleAccordion(this)">ğŸ–¼ï¸ åœºæ™¯ç«‹ç»˜è®¾ç½®</div>
                <div class="accordion-content">
                    <div class="form-group">
                        <label>ä¸Šä¼ å›¾ç‰‡ (ä¸Šä¼ åè‡ªåŠ¨å¼¹å‡ºç¼–è¾‘å™¨)</label>
                        <input type="file" id="sceneImageUpload" accept="image/*" style="border: 1px dashed #ccc; padding: 20px;">
                        <div style="margin-top: 10px; display: flex; gap: 10px;">
                            <button type="button" class="btn-accent" id="editSceneImage" style="display:none;" onclick="openSceneImageEditor()">âœï¸ è°ƒæ•´ä½ç½®</button>
                            <button type="button" class="btn-outline" id="removeSceneImage" onclick="removeSceneImage()">ğŸ—‘ï¸ ç§»é™¤å›¾ç‰‡</button>
                        </div>
                    </div>
                    
                    <div class="form-group" id="sceneImageControls" style="display: none; background: #f0f0f0; padding: 10px; border-radius: 8px;">
                        <div class="form-row">
                            <div>
                                <label>æ¡†å®½åº¦ (<span id="sceneImageWidthValue">350</span>px)</label>
                                <input type="range" id="sceneImageWidth" min="150" max="450" value="350" oninput="updateCard(); syncEditorFrameSize();">
                            </div>
                            <div>
                                <label>æ¡†é«˜åº¦ (<span id="sceneImageHeightValue">200</span>px)</label>
                                <input type="range" id="sceneImageHeight" min="100" max="400" value="200" oninput="updateCard(); syncEditorFrameSize();">
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom:0;">
                            <label style="display:flex; align-items:center; cursor:pointer;">
                                <input type="checkbox" id="hideBorderToggle" onchange="updateCard()" style="width:auto; margin-right:8px;">
                                éšå»ç«‹ç»˜è¾¹æ¡† (é€‚åˆé€æ˜èƒŒæ™¯å›¾)
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æŠ˜å é¡¹ 5: ç‰¹æ€§ -->
            <div class="accordion-item active">
                <div class="accordion-header" onclick="toggleAccordion(this)">âœ¨ åœºæ™¯ç‰¹æ€§</div>
                <div class="accordion-content">
                    <div id="traits" class="dynamic-list"></div>
                    <button type="button" class="add-btn" onclick="addTrait()">+ æ·»åŠ ç‰¹æ€§</button>
                </div>
            </div>

            <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
            <div class="btn-group">
                <button type="button" class="btn-accent" onclick="exportToPNG()">ğŸ“¸ å¯¼å‡ºå›¾ç‰‡</button>
                <button type="button" class="btn-outline" onclick="exportToJSON()">ğŸ’¾ å¯¼å‡º JSON</button>
                <button type="button" class="btn-outline" onclick="importFromJSON()">ğŸ“‚ å¯¼å…¥ JSON</button>
                <button type="button" class="btn-outline" style="margin-left: auto; color: #e53e3e; border-color: #e53e3e;" onclick="resetForm()">ğŸ—‘ï¸ é‡ç½®</button>
            </div>
        </div>

        <!-- å³ä¾§ï¼šé¢„è§ˆé¢æ¿ -->
        <div class="preview-panel">
            <div class="preview-header">
                <h3>æ•ˆæœé¢„è§ˆ</h3>
                <button type="button" onclick="updateCard()" style="font-size: 0.8rem; padding: 5px 10px;">â†» åˆ·æ–°</button>
            </div>
            
            <div class="card-wrapper">
                <!-- æ ¸å¿ƒå¡ç‰‡ DOM -->
                <div id="card-preview" class="environment-card">
                    
                    <!-- å¤´éƒ¨åŒºåŸŸ -->
                    <div class="environment-header" id="environment-header">
                        <div class="environment-text-info">
                            <div class="environment-name" id="card-name">ç¯å¢ƒåç§°</div>
                            <div class="environment-name-en" id="card-name-en">ENVIRONMENT NAME</div>
                            
                            <div class="environment-rank-line">
                                <span id="card-rank">ä½é˜¶1 é™©å¢ƒ</span>
                                <span style="font-weight: 400; color:#666;">|</span>
                                <span>éš¾åº¦ <span id="card-difficulty">10</span></span>
                            </div>
                            
                            <div class="environment-description markdown-content" id="card-description">ç¯å¢ƒæè¿°...</div>
                        </div>

                        <div class="environment-image-container" id="environment-image-container">
                            <div id="card-scene-image" class="environment-image">
                                 <img id="card-scene-image-inner" class="environment-image-inner" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzUwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMzUwIDIwMCI+PHJlY3Qgd2lkdGg9IjM1MCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNmNWY1ZjUiLz48dGV4dCB4PSIxNzUiIHk9IjEwMCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOTk5Ij5OTyBJTUFHRTwvdGV4dD48L2ZzZ3M+" alt="Scene">
                            </div>
                        </div>
                    </div>
                    
                    <!-- è¶‹å‘ä¸æ•Œäºº (ä¼˜åŒ–æ’ç‰ˆ) -->
                    <div class="tendencies-section">
                        <span class="label-block">è¶‹å‘ï¼š</span>
                        <div id="card-tendencies" class="markdown-content text-content-block">...</div>
                    </div>
                    
                    <div class="enemies-section">
                        <span class="label-block">æ½œåœ¨æ•Œäººï¼š</span>
                        <div id="card-enemies" class="markdown-content text-content-block">...</div>
                    </div>
                    
                    <!-- ç‰¹æ€§åˆ—è¡¨ -->
                    <div class="environment-traits">
                        <div class="trait-header">ç‰¹æ€§</div>
                        <div id="card-traits"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å›¾ç‰‡ç¼–è¾‘æ¨¡æ€æ¡† (V2.3: ç§»æ¤ç‰ˆ) -->
    <div id="sceneImageEditModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeSceneImageEditor()">&times;</span>
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin-bottom: 20px; color: var(--accent-ui);">ç¼–è¾‘åœºæ™¯ç«‹ç»˜</h3>
                <label style="color:#aaa; font-size:0.9rem;"><input type="checkbox" id="liveSync" checked> å®æ—¶åŒæ­¥åˆ°å¡ç‰‡</label>
            </div>
            
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <!-- é¢„è§ˆåŒº -->
                <div class="modal-preview-area">
                    <!-- åŠ¨æ€å°ºå¯¸çš„é¢„è§ˆæ¡†: è¿™é‡Œçš„å°ºå¯¸å°†ç”±JSå¼ºåˆ¶ä¸å¡ç‰‡ä¿æŒä¸€è‡´ -->
                    <div id="previewSceneFrame">
                        <img id="previewSceneImage" src="" style="display: block; width: 100%; height: 100%; object-fit: cover;">
                    </div>
                </div>
                
                <!-- æ§ä»¶åŒº -->
                <div class="modal-controls">
                    <div class="form-group">
                        <label>ç¼©æ”¾ <span id="sceneScaleValue">100%</span></label>
                        <input type="range" id="sceneScaleSlider" min="50" max="400" value="100" oninput="updateScenePreview()">
                    </div>
                    <div class="form-group">
                        <label>æ—‹è½¬ <span id="sceneRotateValue">0Â°</span></label>
                        <input type="range" id="sceneRotateSlider" min="-180" max="180" value="0" oninput="updateScenePreview()">
                    </div>
                    <div class="form-group">
                        <label>æ°´å¹³ä½ç½® X <span id="scenePositionXValue">50%</span></label>
                        <input type="range" id="scenePositionXSlider" min="0" max="100" value="50" oninput="updateScenePreview()">
                    </div>
                    <div class="form-group">
                        <label>å‚ç›´ä½ç½® Y <span id="scenePositionYValue">50%</span></label>
                        <input type="range" id="scenePositionYSlider" min="0" max="100" value="50" oninput="updateScenePreview()">
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button type="button" class="btn-accent" id="applySceneEdit" style="width: 100%;">ç¡®è®¤åº”ç”¨</button>
                        <button type="button" class="btn-outline" onclick="closeSceneImageEditor()" style="width: 100%; margin-top: 10px; color:#aaa; border-color:#555;">å…³é—­</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. å·¥å…·ä¸è¾…åŠ©å‡½æ•° ---
        
        function toggleAccordion(header) {
            const item = header.parentElement;
            item.classList.toggle('active');
        }

        function syncColorInput(sourceId, targetId) {
            const source = document.getElementById(sourceId);
            const target = document.getElementById(targetId);
            target.value = source.value.toUpperCase();
        }

        function parseMarkdown(text) {
            if (!text) return '';
            let html = text;
            html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/==(.*?)==/g, '<mark>$1</mark>');
            return html;
        }

        // --- 2. åˆå§‹åŒ–ä¸æ ¸å¿ƒé€»è¾‘ ---
        
        const SCENE_DEFAULT_IMAGE_SRC = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzUwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMzUwIDIwMCI+PHJlY3Qgd2lkdGg9IjM1MCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNmNWY1ZjUiLz48dGV4dCB4PSIxNzUiIHk9IjEwMCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOTk5Ij5OTyBJTUFHRTwvdGV4dD48L2ZzZ3M+";

        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®é»˜è®¤æ•°æ®
            document.getElementById('name').value = 'æ±¹æ¶Œæ²³æµ';
            document.getElementById('nameEn').value = 'RAGING RIVER';
            document.getElementById('description').value = 'ä¸€æ¡æµé€Ÿæ¹æ€¥ã€æ²¡æœ‰æ¡¥æ¢è·¨è¶Šçš„æ²³æµï¼Œæ°´æ·±è¶³ä»¥å†²èµ°å¤§å¤šæ•°äººã€‚';
            document.getElementById('tendencies').value = 'é˜»éš”é€šè¡Œã€å·èµ°æªæ‰‹ä¸åŠçš„äººã€åˆ†éš”ä¸¤å²¸';
            document.getElementById('enemies').value = 'é‡å…½ï¼ˆç†Šï¼Œç»ç’ƒè›‡ï¼‰ã€é”¯é½¿åˆ€å¼ºç›—';
            
            addTrait('å±é™©æ¸¡æ²³ Dangerous Crossing', 'è¢«åŠ¨', 'ç©¿è¶Šæ²³æµéœ€è¦é˜Ÿä¼å®Œæˆä¸€ä¸ªè¿›å±•å€’è®¡æ—¶ï¼ˆ4ï¼‰ã€‚æ·éª°ç»“æœä¸º*ææƒ§*å¤±è´¥çš„ç©å®¶è§’è‰²ä¼šç«‹å³æˆä¸º"æš—æµ"åŠ¨ä½œçš„ç›®æ ‡ã€‚', 'æ˜¯å¦æœ‰ç©å®¶è§’è‰²ä»¥å‰æ›¾æ¶‰æ°´æ¸¡è¿‡ç±»ä¼¼çš„æ²³æµï¼Ÿä»–ä»¬ä¸­æ˜¯å¦æœ‰äºº**å®³æ€•**æººæ°´ï¼Ÿ', 0);
            addTrait('æš—æµ Undertow', 'åŠ¨ä½œ', 'èŠ±è´¹ 1 ææƒ§ç‚¹å°†ä¸€åç©å®¶è§’è‰²å·å…¥æš—æµã€‚å…¶å¿…é¡»è¿›è¡Œä¸€æ¬¡**æ•æ·**ååº”æ·éª°ã€‚å¤±è´¥æ—¶ï¼Œå—åˆ° 1d6+1 ç‚¹ç‰©ç†ä¼¤å®³ã€‚', 'è¿™ç‰‡æ°´åŸŸæ˜¯å¦å­˜åœ¨==æ é£Ÿè€…==ï¼Ÿ', 1);

            // äº‹ä»¶ç›‘å¬
            document.getElementById('sceneImageUpload').addEventListener('change', handleSceneImageUpload);
            document.getElementById('applySceneEdit').addEventListener('click', applySceneEdit);
            
            updateCard();
        });

        // --- 3. å¡ç‰‡æ›´æ–°é€»è¾‘ ---

        function updateCard() {
            // é¢œè‰²è®¾ç½®
            const accentColor = document.getElementById('decoratorColor').value;
            const header = document.getElementById('environment-header');
            const imgFrame = document.getElementById('card-scene-image');
            
            header.style.borderBottomColor = accentColor;
            document.getElementById('card-name-en').style.color = accentColor;
            if(imgFrame) imgFrame.style.borderColor = accentColor;

            // é«˜äº®è®¾ç½®
            const hlBg = document.getElementById('highlightBgColorPicker').value;
            const hlTxt = document.getElementById('highlightTextColorPicker').value;
            const styleTag = document.getElementById('dynamic-mark-style') || document.createElement('style');
            styleTag.id = 'dynamic-mark-style';
            styleTag.innerHTML = `.markdown-content mark { background-color: ${hlBg}; color: ${hlTxt}; }`;
            document.head.appendChild(styleTag);

            // æ–‡æœ¬å†…å®¹
            document.getElementById('card-name').textContent = document.getElementById('name').value || 'ç¯å¢ƒåç§°';
            document.getElementById('card-name-en').textContent = document.getElementById('nameEn').value || 'ENVIRONMENT NAME';
            document.getElementById('card-rank').textContent = `ä½é˜¶${document.getElementById('rank').value} ${document.getElementById('type').value}`;
            document.getElementById('card-difficulty').textContent = document.getElementById('difficulty').value;
            
            document.getElementById('card-description').innerHTML = parseMarkdown(document.getElementById('description').value);
            document.getElementById('card-tendencies').innerHTML = parseMarkdown(document.getElementById('tendencies').value);
            document.getElementById('card-enemies').innerHTML = parseMarkdown(document.getElementById('enemies').value);

            // å›¾ç‰‡å®½é«˜ä¸è¾¹æ¡†
            const imgW = document.getElementById('sceneImageWidth').value;
            const imgH = document.getElementById('sceneImageHeight').value;
            const hideBorder = document.getElementById('hideBorderToggle').checked;
            
            const container = document.getElementById('environment-image-container');
            container.style.width = imgW + 'px';
            container.style.height = imgH + 'px';
            
            document.getElementById('sceneImageWidthValue').textContent = imgW;
            document.getElementById('sceneImageHeightValue').textContent = imgH;
            
            if(hideBorder) imgFrame.classList.add('no-border');
            else imgFrame.classList.remove('no-border');

            // æ¸²æŸ“ç‰¹æ€§
            renderTraits();
        }

        // --- 4. ç‰¹æ€§ç®¡ç† ---

        function addTrait(name = '', type = 'è¢«åŠ¨', description = '', questions = '', fearCost = 0) {
            const div = document.createElement('div');
            div.className = 'trait-input-box';
            div.innerHTML = `
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <input type="text" class="trait-name-input" value="${name}" placeholder="ç‰¹æ€§åç§°" style="flex:2; font-weight:bold;">
                    <select class="trait-type-select" style="flex:1;">
                        <option value="è¢«åŠ¨" ${type === 'è¢«åŠ¨' ? 'selected' : ''}>è¢«åŠ¨</option>
                        <option value="åŠ¨ä½œ" ${type === 'åŠ¨ä½œ' ? 'selected' : ''}>åŠ¨ä½œ</option>
                        <option value="ååº”" ${type === 'ååº”' ? 'selected' : ''}>ååº”</option>
                    </select>
                    <div style="display:flex; align-items:center; gap:5px; flex:1;">
                        <input type="checkbox" class="fear-trait-checkbox" ${fearCost > 0 ? 'checked' : ''} onchange="this.nextElementSibling.disabled = !this.checked; updateCard();">
                        <input type="number" class="fear-cost-input" value="${fearCost}" min="1" max="5" ${fearCost > 0 ? '' : 'disabled'} placeholder="ç‚¹æ•°" style="width:100%;">
                    </div>
                </div>
                <textarea class="trait-desc-input" placeholder="ç‰¹æ€§æè¿°" oninput="updateCard()" style="width:100%; margin-bottom:10px; min-height:60px;">${description}</textarea>
                <textarea class="trait-questions-input" placeholder="å¼•å¯¼é—®é¢˜ (å¯é€‰)" oninput="updateCard()" style="width:100%; margin-bottom:10px; min-height:40px;">${questions}</textarea>
                <div style="text-align:right;">
                    <button type="button" class="remove-btn" onclick="this.parentElement.parentElement.remove(); updateCard();">åˆ é™¤ç‰¹æ€§</button>
                </div>
            `;
            document.getElementById('traits').appendChild(div);
            updateCard();
        }

        function renderTraits() {
            const container = document.getElementById('card-traits');
            container.innerHTML = '';
            
            const items = document.querySelectorAll('#traits .trait-input-box');
            if (items.length === 0) {
                container.innerHTML = `<div class="trait" style="color:#999; font-style:italic;">æ— ç‰¹æ€§</div>`;
                return;
            }

            items.forEach(item => {
                const name = item.querySelector('.trait-name-input').value;
                const type = item.querySelector('.trait-type-select').value;
                const desc = item.querySelector('.trait-desc-input').value;
                const questions = item.querySelector('.trait-questions-input').value;
                const isFear = item.querySelector('.fear-trait-checkbox').checked;
                const cost = item.querySelector('.fear-cost-input').value;

                if (name || desc) {
                    const div = document.createElement('div');
                    div.className = 'trait';
                    
                    let title = name || 'ç‰¹æ€§';
                    if (type) title += ` - ${type}`;
                    if (isFear && cost > 0) title += ` [${cost} ææƒ§ç‚¹]`;

                    let html = `<span class="trait-name">${title}</span>`;
                    if (desc) html += `<span class="trait-desc markdown-content">${parseMarkdown(desc)}</span>`;
                    if (questions) html += `<span class="trait-questions markdown-content">${parseMarkdown(questions)}</span>`;
                    
                    div.innerHTML = html;
                    container.appendChild(div);
                }
            });
        }

        // --- 5. å›¾ç‰‡ç¼–è¾‘å™¨é€»è¾‘ (æ ¸å¿ƒç§»æ¤éƒ¨åˆ†) ---

        function handleSceneImageUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const src = event.target.result;
                    document.getElementById('card-scene-image-inner').src = src;
                    document.getElementById('previewSceneImage').src = src;
                    
                    document.getElementById('environment-header').classList.add('has-image');
                    document.getElementById('editSceneImage').style.display = 'inline-block';
                    document.getElementById('sceneImageControls').style.display = 'block';
                    
                    // é‡ç½®å˜æ¢
                    document.getElementById('card-scene-image-inner').style.transform = '';
                    
                    // è‡ªåŠ¨æ‰“å¼€ç¼–è¾‘å™¨
                    openSceneImageEditor();
                    updateCard();
                };
                reader.readAsDataURL(file);
            }
        }

        function removeSceneImage() {
            document.getElementById('card-scene-image-inner').src = SCENE_DEFAULT_IMAGE_SRC;
            document.getElementById('sceneImageUpload').value = '';
            document.getElementById('environment-header').classList.remove('has-image');
            document.getElementById('editSceneImage').style.display = 'none';
            document.getElementById('sceneImageControls').style.display = 'none';
            updateCard();
        }

        function syncEditorFrameSize() {
            // è·å–å½“å‰å¡ç‰‡ä¸Šè®¾ç½®çš„å®½é«˜
            const w = document.getElementById('sceneImageWidth').value;
            const h = document.getElementById('sceneImageHeight').value;
            
            // å¼ºåˆ¶åŒæ­¥ç»™ç¼–è¾‘å™¨çš„é¢„è§ˆæ¡†
            const frame = document.getElementById('previewSceneFrame');
            frame.style.width = w + 'px';
            frame.style.height = h + 'px';
        }

        function openSceneImageEditor() {
            document.getElementById('sceneImageEditModal').style.display = 'flex';
            
            // å…³é”®ï¼šæ‰“å¼€æ—¶ç«‹å³åŒæ­¥å°ºå¯¸ï¼Œç¡®ä¿ WYSIWYG
            syncEditorFrameSize();
            
            const realImg = document.getElementById('card-scene-image-inner');
            const previewImg = document.getElementById('previewSceneImage');
            previewImg.src = realImg.src;

            // è¯»å–ç°æœ‰ transform
            const transform = realImg.style.transform;
            let scale = 100, rot = 0, x = 50, y = 50;
            
            if (transform) {
                const s = transform.match(/scale\(([\d.]+)\)/);
                if (s) scale = parseFloat(s[1]) * 100;
                const r = transform.match(/rotate\(([\d.-]+)deg\)/);
                if (r) rot = parseFloat(r[1]);
                const t = transform.match(/translate\(([\d.-]+)%,\s*([\d.-]+)%\)/);
                if (t) {
                    x = 50 - parseFloat(t[1]);
                    y = 50 - parseFloat(t[2]);
                }
            }
            
            document.getElementById('sceneScaleSlider').value = scale;
            document.getElementById('sceneRotateSlider').value = rot;
            document.getElementById('scenePositionXSlider').value = x;
            document.getElementById('scenePositionYSlider').value = y;
            
            updateScenePreview();
        }

        function closeSceneImageEditor() {
            document.getElementById('sceneImageEditModal').style.display = 'none';
        }

        function updateScenePreview() {
            const scale = document.getElementById('sceneScaleSlider').value;
            const rot = document.getElementById('sceneRotateSlider').value;
            const x = document.getElementById('scenePositionXSlider').value;
            const y = document.getElementById('scenePositionYSlider').value;
            
            document.getElementById('sceneScaleValue').innerText = scale + '%';
            document.getElementById('sceneRotateValue').innerText = rot + 'Â°';
            document.getElementById('scenePositionXValue').innerText = x + '%';
            document.getElementById('scenePositionYValue').innerText = y + '%';
            
            const transform = `scale(${scale/100}) rotate(${rot}deg) translate(${50-x}%, ${50-y}%)`;
            document.getElementById('previewSceneImage').style.transform = transform;

            // å®æ—¶åŒæ­¥
            if(document.getElementById('liveSync').checked) {
                document.getElementById('card-scene-image-inner').style.transform = transform;
            }
        }

        function applySceneEdit() {
            // å†æ¬¡ç¡®ä¿åŒæ­¥
            const previewImg = document.getElementById('previewSceneImage');
            document.getElementById('card-scene-image-inner').style.transform = previewImg.style.transform;
            closeSceneImageEditor();
        }

        // --- 6. å¯¼å‡º/å¯¼å…¥ (V2.3: ç§»æ¤ JSON ç»“æ„) ---

        function exportToPNG() {
            html2canvas(document.getElementById('card-preview'), {
                scale: 2,
                backgroundColor: null,
                borderRadius: '16px'
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `${document.getElementById('name').value || 'scene'}_card.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        function exportToJSON() {
            const img = document.getElementById('card-scene-image-inner');
            const data = {
                name: document.getElementById('name').value,
                nameEn: document.getElementById('nameEn').value,
                rank: document.getElementById('rank').value,
                type: document.getElementById('type').value,
                description: document.getElementById('description').value,
                tendencies: document.getElementById('tendencies').value,
                difficulty: document.getElementById('difficulty').value,
                enemies: document.getElementById('enemies').value,
                // Colors
                decoratorColor: document.getElementById('decoratorColor').value,
                highlightBgColor: document.getElementById('highlightBgColorPicker').value,
                highlightTextColor: document.getElementById('highlightTextColorPicker').value,
                // Image Settings (V2.3 Updated)
                imageSettings: {
                    src: img.src,
                    width: document.getElementById('sceneImageWidth').value,
                    height: document.getElementById('sceneImageHeight').value,
                    transform: img.style.transform,
                    hideBorder: document.getElementById('hideBorderToggle').checked
                },
                traits: []
            };
            
            document.querySelectorAll('#traits .trait-input-box').forEach(box => {
                data.traits.push({
                    name: box.querySelector('.trait-name-input').value,
                    type: box.querySelector('.trait-type-select').value,
                    fear: box.querySelector('.fear-trait-checkbox').checked,
                    cost: box.querySelector('.fear-cost-input').value,
                    desc: box.querySelector('.trait-desc-input').value,
                    qs: box.querySelector('.trait-questions-input').value
                });
            });

            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = (data.name || 'scene') + '.json';
            a.click();
        }

        function importFromJSON() {
            const input = document.createElement('input');
            input.type = 'file'; accept = '.json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = event => {
                    const data = JSON.parse(event.target.result);
                    
                    document.getElementById('name').value = data.name || '';
                    document.getElementById('nameEn').value = data.nameEn || '';
                    document.getElementById('rank').value = data.rank || '1';
                    document.getElementById('type').value = data.type || 'é™©å¢ƒ';
                    document.getElementById('description').value = data.description || '';
                    document.getElementById('tendencies').value = data.tendencies || '';
                    document.getElementById('difficulty').value = data.difficulty || 10;
                    document.getElementById('enemies').value = data.enemies || '';
                    
                    if(data.decoratorColor) {
                        document.getElementById('decoratorColor').value = data.decoratorColor;
                        document.getElementById('decoratorColorPicker').value = data.decoratorColor;
                    }
                    if(data.highlightBgColor) document.getElementById('highlightBgColorPicker').value = data.highlightBgColor;
                    if(data.highlightTextColor) document.getElementById('highlightTextColorPicker').value = data.highlightTextColor;

                    // Image (V2.3: Support imageSettings)
                    const imgData = data.imageSettings || data.image;
                    
                    if(imgData && imgData.src && imgData.src !== SCENE_DEFAULT_IMAGE_SRC) {
                        document.getElementById('card-scene-image-inner').src = imgData.src;
                        document.getElementById('previewSceneImage').src = imgData.src;
                        
                        document.getElementById('sceneImageWidth').value = imgData.width || 350;
                        document.getElementById('sceneImageHeight').value = imgData.height || 200;
                        document.getElementById('hideBorderToggle').checked = !!imgData.hideBorder;
                        document.getElementById('card-scene-image-inner').style.transform = imgData.transform || '';
                        
                        document.getElementById('environment-header').classList.add('has-image');
                        document.getElementById('editSceneImage').style.display = 'inline-block';
                        document.getElementById('sceneImageControls').style.display = 'block';
                    } else {
                        removeSceneImage();
                    }

                    document.getElementById('traits').innerHTML = '';
                    if(data.traits) {
                        data.traits.forEach(t => addTrait(t.name, t.type, t.desc, t.qs, t.fear ? t.cost : 0));
                    }

                    updateCard();
                    alert('å¯¼å…¥æˆåŠŸï¼');
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function resetForm() {
            if(confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿ')) location.reload();
        }
    </script>
</body>
</html>